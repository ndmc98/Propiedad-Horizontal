--   -------------------------------------------------- 
--   Generated by Enterprise Architect Version 8.0.856
--   Created On : sábado, 03 diciembre, 2016 
--   DBMS       : Oracle 
--   -------------------------------------------------- 



--  Drop Tables, Stored Procedures and Views 

DROP TABLE Apartamento CASCADE CONSTRAINTS
;
DROP TABLE Bloquee CASCADE CONSTRAINTS
;
DROP TABLE Conjunto CASCADE CONSTRAINTS
;
DROP TABLE Cuota CASCADE CONSTRAINTS
;
DROP TABLE CuotaApt CASCADE CONSTRAINTS
;
DROP TABLE EspacioComun CASCADE CONSTRAINTS
;
DROP TABLE Pago CASCADE CONSTRAINTS
;
DROP TABLE PagoEspacio CASCADE CONSTRAINTS
;
DROP TABLE Parqueadero CASCADE CONSTRAINTS
;
DROP TABLE Persona CASCADE CONSTRAINTS
;
DROP TABLE Reserva CASCADE CONSTRAINTS
;
DROP TABLE Responsable CASCADE CONSTRAINTS
;
DROP TABLE Telefono CASCADE CONSTRAINTS
;

--  Create Tables 
CREATE TABLE Apartamento
(
	k_idapartamento   NUMBER(4) NOT NULL,
	q_area            NUMBER(3) NOT NULL,
	q_piso            NUMBER(3) NOT NULL,
	t_coeficiente     NUMBER(4,2) NOT NULL,
	k_identificacion  NUMBER(12) NOT NULL,
	k_idbloquee       NUMBER(4) NOT NULL
)
;


CREATE TABLE Bloquee
(
	k_idbloquee  NUMBER(4) NOT NULL,
	k_codigo     NUMBER(4) NOT NULL
)
;


CREATE TABLE Conjunto
(
	k_codigo          NUMBER(4) NOT NULL,
	n_nombre          VARCHAR(30) NOT NULL,
	v_mensual         NUMBER(6) NOT NULL,
	t_descuento       NUMBER(5,2),
	q_cuentabancaria  NUMBER(8) NOT NULL,
	q_diasdescuento   NUMBER(2),
	t_mora            NUMBER(5,2) NOT NULL
)
;


CREATE TABLE Cuota
(
	k_idcuota        NUMBER(4) NOT NULL,
	i_tipo           VARCHAR(14) NOT NULL,
	n_concepto       VARCHAR(100) NOT NULL,
	v_cuota          NUMBER(10) NOT NULL,
	f_plazo          DATE NOT NULL,
	q_saldoanterior  NUMBER(6) NOT NULL,
	t_valormora      NUMBER(6) NOT NULL,
	i_estadoCuota    VARCHAR(9) NOT NULL,
	k_idapartamento  NUMBER(4)
)
;


CREATE TABLE CuotaApt
(
	k_idcuota        NUMBER(4) NOT NULL,
	k_idapartamento  NUMBER(4) NOT NULL,
	i_estado         VARCHAR(9) NOT NULL
)
;


CREATE TABLE EspacioComun
(
	k_idespaciocomun  NUMBER(4) NOT NULL,
	n_tipoEspacio     VARCHAR(25) NOT NULL,
	v_alquiler        NUMBER(10) NOT NULL,
	k_codigo          NUMBER(4) NOT NULL,
	i_estadoEspacio   CHAR(1) NOT NULL
)
;


CREATE TABLE Pago
(
	k_idpago       NUMBER(4) NOT NULL,
	n_formapago    VARCHAR(50) NOT NULL,
	f_pago         DATE NOT NULL,
	k_idcuota      NUMBER(4) NOT NULL,
	q_valorpagado  NUMBER(6) NOT NULL
)
;


CREATE TABLE PagoEspacio
(
	k_idpagoespacio  NUMBER(4) NOT NULL,
	f_pagoec         DATE NOT NULL,
	q_valorpagado    NUMBER(6) NOT NULL,
	n_formapago      VARCHAR(25) NOT NULL,
	k_idreserva      NUMBER(4)
)
;


CREATE TABLE Parqueadero
(
	k_idparqueadero  NUMBER(4) NOT NULL,
	k_idapartamento  NUMBER(4) NOT NULL
)
;


CREATE TABLE Persona
(
	k_identificacion  NUMBER(12) NOT NULL,
	n_primernombre    VARCHAR(25) NOT NULL,
	n_correo          VARCHAR(25) NOT NULL,
	n_genero          CHAR(1) NOT NULL,
	n_apellido        VARCHAR(25) NOT NULL,
	k_idapartamento   NUMBER(4)
)
;


CREATE TABLE Reserva
(
	k_idreserva       NUMBER(4) NOT NULL,
	f_fin             DATE NOT NULL,
	f_inicio          DATE NOT NULL,
	k_identificacion  NUMBER(12) NOT NULL,
	k_idespaciocomun  NUMBER(4) NOT NULL
)
;


CREATE TABLE Responsable
(
	i_tipoRespons     VARCHAR(12) NOT NULL,
	k_identificacion  NUMBER(12) NOT NULL
)
;


CREATE TABLE Telefono
(
	k_idtelefono      NUMBER(10) NOT NULL,
	k_identificacion  NUMBER(12) NOT NULL
)
;



--  Create Primary Key Constraints 
ALTER TABLE Apartamento ADD CONSTRAINT PK_Apartamento 
	PRIMARY KEY (k_idapartamento)
;

ALTER TABLE Bloquee ADD CONSTRAINT PK_Bloquee 
	PRIMARY KEY (k_idbloquee)
;

ALTER TABLE Conjunto ADD CONSTRAINT PK_Conjunto 
	PRIMARY KEY (k_codigo)
;

ALTER TABLE Cuota ADD CONSTRAINT PK_Cuota 
	PRIMARY KEY (k_idcuota)
;

ALTER TABLE CuotaApt ADD CONSTRAINT PK_CuotaApt 
	PRIMARY KEY (k_idcuota, k_idapartamento)
;

ALTER TABLE EspacioComun ADD CONSTRAINT PK_EspacioComun 
	PRIMARY KEY (k_idespaciocomun)
;

ALTER TABLE Pago ADD CONSTRAINT PK_Pago 
	PRIMARY KEY (k_idpago)
;

ALTER TABLE PagoEspacio ADD CONSTRAINT PK_PagoEspacio 
	PRIMARY KEY (k_idpagoespacio)
;

ALTER TABLE Parqueadero ADD CONSTRAINT PK_Parqueadero 
	PRIMARY KEY (k_idparqueadero, k_idapartamento)
;

ALTER TABLE Persona ADD CONSTRAINT PK_Persona 
	PRIMARY KEY (k_identificacion)
;

ALTER TABLE Reserva ADD CONSTRAINT PK_Reserva 
	PRIMARY KEY (k_idreserva)
;

ALTER TABLE Responsable ADD CONSTRAINT PK_Responsable 
	PRIMARY KEY (k_identificacion)
;

ALTER TABLE Telefono ADD CONSTRAINT PK_Telefono 
	PRIMARY KEY (k_idtelefono, k_identificacion)
;


--  Create Indexes 
ALTER TABLE Apartamento
ADD CONSTRAINT CK_idapartamento CHECK (k_idapartamento>0)
;

ALTER TABLE Apartamento
ADD CONSTRAINT CK_area CHECK (q_area>0)
;

ALTER TABLE Apartamento
ADD CONSTRAINT CK_piso CHECK (q_piso>0)
;

ALTER TABLE Apartamento
ADD CONSTRAINT CK_coeficiente CHECK (t_coeficiente>0)
;

ALTER TABLE Bloquee
ADD CONSTRAINT CK_idbloquee CHECK (k_idbloquee>0)
;

ALTER TABLE Conjunto
	ADD CONSTRAINT UQ_Conjunto_n_nombre UNIQUE (n_nombre)
;

ALTER TABLE Conjunto
	ADD CONSTRAINT UQ_Conjunto_q_cuentabancaria UNIQUE (q_cuentabancaria)
;

ALTER TABLE Conjunto
ADD CONSTRAINT CK_codigo CHECK (k_codigo>=1)
;

ALTER TABLE Conjunto
ADD CONSTRAINT CK_mensual CHECK (v_mensual>0)
;

ALTER TABLE Conjunto
ADD CONSTRAINT CK_descuento CHECK (t_descuento<=100 and t_descuento>0)
;

ALTER TABLE Conjunto
ADD CONSTRAINT CK_cuentabancaria CHECK (q_cuentabancaria>0)
;

ALTER TABLE Conjunto
ADD CONSTRAINT CK_diasdescuento CHECK (q_diasdescuento>=1 and q_diasdescuento<=31)
;

ALTER TABLE Conjunto
ADD CONSTRAINT CK_mora CHECK (t_mora>0 and t_mora<=100)
;

ALTER TABLE Cuota
ADD CONSTRAINT CK_idcuota CHECK (k_idcuota>0)
;

ALTER TABLE Cuota
ADD CONSTRAINT CK_tipo CHECK (i_tipo = 'ORDINARIA' or i_tipo = 'EXTRAORDINARIA')
;

ALTER TABLE Cuota
ADD CONSTRAINT CK_cuota CHECK (v_cuota>0)
;

ALTER TABLE Cuota
ADD CONSTRAINT CK_estadoCuota CHECK (i_estadoCuota='PAGADO' or i_estadoCuota='NO_PAGADO')
;

ALTER TABLE CuotaApt
ADD CONSTRAINT CK_estado CHECK (i_estado = 'PAGADO' or i_estado = 'NO-PAGADO')
;

ALTER TABLE EspacioComun
ADD CONSTRAINT CK_idespaciocomun CHECK (k_idespaciocomun>0)
;

ALTER TABLE EspacioComun
ADD CONSTRAINT CK_alquiler CHECK (v_alquiler>0)
;

ALTER TABLE EspacioComun
ADD CONSTRAINT CK_estadoEspacio CHECK (i_estadoEspacio='T' or i_estadoEspacio='F')
;

ALTER TABLE EspacioComun
ADD CONSTRAINT CK_tipoEspacio CHECK (n_tipoEspacio='SALON' or n_tipoEspacio = 'PARQ_VSNTE' or n_tipoEspacio = 'BBQ')
;

ALTER TABLE Pago
	ADD CONSTRAINT UQ_Pago_k_idcuota UNIQUE (k_idcuota)
;

ALTER TABLE Pago
ADD CONSTRAINT CK_idpago CHECK (k_idpago>0)
;

ALTER TABLE PagoEspacio
ADD CONSTRAINT CK_idpagoespacio CHECK (k_idpagoespacio>0)
;

ALTER TABLE Parqueadero
ADD CONSTRAINT CK_idparqueadero CHECK (k_idparqueadero>0)
;

ALTER TABLE Persona
	ADD CONSTRAINT UQ_Persona_n_correo UNIQUE (n_correo)
;

ALTER TABLE Persona
ADD CONSTRAINT CK_identificacion CHECK (k_identificacion>0)
;

ALTER TABLE Persona
ADD CONSTRAINT CK_genero CHECK (n_genero='F' or n_genero='M')
;

ALTER TABLE Reserva
ADD CONSTRAINT CK_idreserva CHECK (k_idreserva>0)
;

ALTER TABLE Responsable
ADD CONSTRAINT CK_tipoRespons CHECK (i_tipoRespons = 'ARRENDATARIO' or i_tipoRespons = 'PROPIETARIO')
;

ALTER TABLE Telefono
ADD CONSTRAINT CK_idtelefono CHECK (k_idtelefono>0)
;


--  Create Foreign Key Constraints 
ALTER TABLE Apartamento ADD CONSTRAINT FK_Apartamento_Bloquee 
	FOREIGN KEY (k_idbloquee) REFERENCES Bloquee (k_idbloquee)
;

ALTER TABLE Apartamento ADD CONSTRAINT FK_Apartamento_Responsable 
	FOREIGN KEY (k_identificacion) REFERENCES Responsable (k_identificacion)
;

ALTER TABLE Bloquee ADD CONSTRAINT FK_Bloquee_Conjunto 
	FOREIGN KEY (k_codigo) REFERENCES Conjunto (k_codigo)
;

ALTER TABLE Cuota ADD CONSTRAINT FK_Cuota_Apartamento 
	FOREIGN KEY (k_idapartamento) REFERENCES Apartamento (k_idapartamento)
;

ALTER TABLE CuotaApt ADD CONSTRAINT FK_CuotaApt_Apartamento 
	FOREIGN KEY (k_idapartamento) REFERENCES Apartamento (k_idapartamento)
;

ALTER TABLE CuotaApt ADD CONSTRAINT FK_CuotaApt_Cuota 
	FOREIGN KEY (k_idcuota) REFERENCES Cuota (k_idcuota)
;

ALTER TABLE EspacioComun ADD CONSTRAINT FK_EspacioComun_Conjunto 
	FOREIGN KEY (k_codigo) REFERENCES Conjunto (k_codigo)
;

ALTER TABLE Pago ADD CONSTRAINT FK_Pago_Cuota 
	FOREIGN KEY (k_idcuota) REFERENCES Cuota (k_idcuota)
;

ALTER TABLE PagoEspacio ADD CONSTRAINT FK_PagoEspacio_Reserva 
	FOREIGN KEY (k_idreserva) REFERENCES Reserva (k_idreserva)
;

ALTER TABLE Parqueadero ADD CONSTRAINT FK_Parqueadero_Apartamento 
	FOREIGN KEY (k_idapartamento) REFERENCES Apartamento (k_idapartamento)
;

ALTER TABLE Persona ADD CONSTRAINT FK_Persona_Apartamento 
	FOREIGN KEY (k_idapartamento) REFERENCES Apartamento (k_idapartamento)
;

ALTER TABLE Reserva ADD CONSTRAINT FK_Reserva_EspacioComun 
	FOREIGN KEY (k_idespaciocomun) REFERENCES EspacioComun (k_idespaciocomun)
;

ALTER TABLE Reserva ADD CONSTRAINT FK_Reserva_Responsable 
	FOREIGN KEY (k_identificacion) REFERENCES Responsable (k_identificacion)
;

ALTER TABLE Responsable ADD CONSTRAINT FK_Responsable_Persona 
	FOREIGN KEY (k_identificacion) REFERENCES Persona (k_identificacion)
;

ALTER TABLE Telefono ADD CONSTRAINT FK_Telefono_Persona 
	FOREIGN KEY (k_identificacion) REFERENCES Persona (k_identificacion)
;
